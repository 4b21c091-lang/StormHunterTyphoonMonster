<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>é¢±é¢¨ç™¾ç§‘æ•™å®¤</title>
<!-- Font Awesome ç”¨æ–¼é¡¯ç¤ºé¦–é åœ–ç¤º -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<!-- Bootstrap CSS (ç‚ºäº†æŒ‰éˆ•æ¨£å¼ä¸€è‡´æ€§) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  :root {
    /* ç²‰å½©ä¸»é¡Œè‰²ç³» */
    --c-track: #e0f2fe;
    --c-thumb: #ffffff;
    --c-text: #475569;
    --c-accent: #38bdf8;
    
    /* åœ“è§’èˆ‡å­—é«” */
    --radius-l: 30px;
    --radius-m: 20px;
    --radius-s: 12px;
    --font-round: "Nunito", "Varela Round", "M PLUS Rounded 1c", "Hiragino Maru Gothic ProN", "Microsoft JhengHei", system-ui, sans-serif;
    
    /* èƒŒæ™¯æ¼¸å±¤ */
    --bg-1: linear-gradient(135deg, #e0f7fa 0%, #fff9c4 100%); /* S1: æ™´æœ—å¾®é¢¨ */
    --bg-2: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 100%); /* S2: æœ‰é»è—è®Šæ·± */
    /* S3 ä¸­åº¦é¢±é¢¨èƒŒæ™¯èª¿æ·± (æ·±è—è‰²/æš´é¢¨å‰å¤•) */
    --bg-3: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%); 
    --bg-4: linear-gradient(135deg, #78909c 0%, #37474f 100%); /* S4: æš´é¢¨ç°æš— (æ›´æš—ä¸€é») */
  }

  /* æ³¨éŸ³å°ˆç”¨æ¨£å¼ */
  ruby {
    display: inline-flex;
    align-items: center;
    vertical-align: middle;
    margin: 0 0.1em;
    line-height: 1.2;
  }
  ruby > span { display: block; }
  rt {
    display: inline-flex !important;
    flex-direction: row;
    align-items: center;
    font-size: 0.4em;
    line-height: 1;
    margin-left: 0.2em;
    color: inherit;
    font-family: "Bopomofo", "Noto Sans TC", sans-serif;
    font-weight: 500;
    height: 100%;
  }
  .zhuyin-symbols {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    line-height: 1.1;
  }
  .zhuyin-tone {
    display: block;
    margin-left: 0.1em;
    font-size: 1.0em;
    transform: translateY(-5%);
  }
  rt.has-light-tone {
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
  }
  .zhuyin-tone-light {
    display: block;
    width: 100%;
    text-align: center;
    font-size: 1.5em;
    margin-bottom: -0.2em;
    margin-left: 0;
  }
  /* çµæŸæ³¨éŸ³æ¨£å¼ */

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    margin: 0;
    height: 100vh;
    font-family: var(--font-round);
    color: var(--c-text);
    background: var(--bg-1);
    transition: background 1.2s ease, color 0.8s ease; /* èƒŒæ™¯éæ¸¡èª¿æ…¢ä¸€é»æ¯”è¼ƒè‡ªç„¶ */
    overflow: hidden;
  }

  /* ä½ˆå±€å®¹å™¨ */
  .app {
    display: flex;
    width: 100%;
    height: 100%;
    position: relative;
  }

  /* --- å·¦å´æ§åˆ¶æ¢ (QQé¢¨æ ¼) --- */
  .sidebar {
    width: 110px;
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(10px);
    border-right: 1px solid rgba(255,255,255,0.5);
    z-index: 50;
    gap: 15px;
  }

  /* å›ä¸»é æŒ‰éˆ•æ¨£å¼ */
  .home-btn {
      background-color: white;
      border: 2px solid #334155;
      color: #334155;
      padding: 0.5rem 0.8rem;
      border-radius: 50rem;
      font-weight: 700;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      font-size: 0.9rem;
      white-space: nowrap;
      margin-bottom: 5px;
      font-family: inherit;
  }

  .home-btn:hover {
      background-color: #334155 !important;
      color: white !important;
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 15px rgba(51, 65, 85, 0.3);
  }
  
  .home-btn:hover ruby, .home-btn:hover rt {
      color: white !important;
  }

  .home-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(51, 65, 85, 0.2);
  }

  .btn-circle {
    width: 48px; height: 48px;
    border-radius: 50%;
    border: none;
    background: white;
    box-shadow: 0 4px 12px rgba(56, 189, 248, 0.2);
    color: var(--c-accent);
    font-size: 24px;
    font-weight: 900;
    cursor: pointer;
    transition: transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: grid;
    place-items: center;
    flex-shrink: 0;
  }
  .btn-circle:active { transform: scale(0.9); }
  .btn-circle:hover { transform: scale(1.1); }

  /* å‚ç›´æ»‘æ¡¿å®¹å™¨ */
  .slider-container {
    flex: 1;
    width: 100%;
    display: flex;
    justify-content: center;
    position: relative;
    padding: 10px 0;
    min-height: 200px;
  }
  
  .track-bg {
    width: 24px;
    height: 100%;
    background: var(--c-track);
    border-radius: 99em;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
    position: relative;
  }

  /* æ»‘æ¡¿é ­ (Thumb) */
  .thumb {
    position: absolute;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 6px 16px rgba(56, 189, 248, 0.3);
    border: 4px solid white;
    cursor: grab;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: top 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .thumb::after {
    content:''; width: 24px; height: 24px;
    background: var(--c-accent);
    border-radius: 50%;
  }
  .thumb:active { cursor: grabbing; transform: translate(-50%, -50%) scale(0.95); }

  /* åˆ»åº¦é» */
  .dots {
    position: absolute;
    top: 10px; bottom: 10px; left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    pointer-events: none;
    height: calc(100% - 20px);
  }
  .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.8); border-radius: 50%; }

  /* --- ä¸»ç•«é¢ --- */

  .main-stage {
    flex: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 6vh;
    z-index: 5; /* ç¢ºä¿åœ¨èƒŒæ™¯ç‰¹æ•ˆä¹‹ä¸Š */
  }

  .header-text {
    text-align: center;
    z-index: 20;
    margin-bottom: 20px;
    text-shadow: 0 2px 4px rgba(255,255,255,0.8);
    transition: color 0.8s ease, text-shadow 0.8s ease;
  }
  .title { 
      font-size: clamp(24px, 4vw, 32px); 
      font-weight: 800; 
      margin:0;
      display: flex;
      justify-content: center;
      flex-wrap: wrap; 
  }
  .subtitle { 
      font-size: 20px;
      opacity: 0.9; 
      margin-top: 8px; 
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      font-weight: 700;
  }

  /* é›²æœµè§’è‰²å€ */
  .character-wrap {
    width: 300px;
    height: 200px;
    position: relative;
    z-index: 10;
    transition: transform 0.5s ease;
  }
  
  .cloud-body {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.1));
    animation: floaty 3s ease-in-out infinite;
    transform-origin: center center;
    transition: transform 0.3s ease, filter 0.8s ease;
  }
  
  @keyframes floaty {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
  }

  /* é¢¨å‹•ç•« (SVG) */
  .wind-lines {
    position: absolute;
    top: 50%; left: 50%;
    width: 120%; height: 120%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 5;
    opacity: 0.6;
  }
  .wind-path {
    fill: none;
    stroke: white;
    stroke-width: 6;
    stroke-linecap: round;
    stroke-dasharray: 40 60;
    opacity: 0.8;
    animation: wind-dash 3s linear infinite;
    filter: drop-shadow(0 2px 5px rgba(0,0,0,0.1));
  }
  @keyframes wind-dash {
    to { stroke-dashoffset: -200; }
  }

  /* è³‡è¨Šå¡ç‰‡æ¨£å¼ */
  .info-card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(12px);
    border-radius: 40px;
    padding: 32px;
    width: 95%;
    max-width: 850px;
    text-align: center;
    margin-top: 40px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    z-index: 20;
    position: relative;
    transform: translateY(0);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 3px solid rgba(255, 255, 255, 0.6);
  }
  .info-card::before { /* å°è©±æ¡†å°–è§’ */
    content: "";
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 0 15px 15px 15px;
    border-style: solid;
    border-color: transparent transparent rgba(255,255,255,0.9) transparent;
  }
  
  /* ç­‰ç´šæ¨™ç±¤ */
  .level-badge {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    background: var(--c-accent);
    color: white;
    padding: 8px 24px;
    border-radius: 99em;
    font-size: 22px;
    font-weight: 900;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transition: background-color 0.8s ease;
  }
  .level-badge ruby, .level-badge rt { color: white !important; }

  /* èªªæ˜æ–‡å­— */
  .info-desc { 
      line-height: 2.8;
      font-size: 26px;
      display: block;
      font-weight: 700;
      color: #334155;
  }

  /* èƒŒæ™¯é›²å±¤æ•ˆæœ */
  .cloud-layer {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1; /* åœ¨æœ€åº•å±¤ */
      opacity: 0;
      transition: opacity 1s ease, filter 1s ease;
      /* ä½¿ç”¨é‡è¤‡çš„å¾‘å‘æ¼¸å±¤æ¨¡æ“¬é›²æœµ */
      background-image: 
          radial-gradient(circle at 20% 30%, rgba(255,255,255,0.7) 0%, transparent 50%),
          radial-gradient(circle at 80% 60%, rgba(255,255,255,0.6) 0%, transparent 40%),
          radial-gradient(circle at 40% 80%, rgba(255,255,255,0.5) 0%, transparent 60%),
          radial-gradient(circle at 90% 10%, rgba(255,255,255,0.7) 0%, transparent 50%);
      background-size: 200% 200%;
      animation: cloud-drift 80s linear infinite;
  }
  @keyframes cloud-drift {
      from { background-position: 0% 0%; }
      to { background-position: 100% 50%; }
  }

  /* ç†±å¸¶ä½æ°£å£“é›²æœµèšé›†å±¤ */
  .gathering-layer {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
    z-index: 2; /* åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼Œè§’è‰²ä¹‹ä¸‹ */
    overflow: hidden;
    opacity: 0;
    transition: opacity 1s ease;
  }
  /* åªæœ‰ S1 é¡¯ç¤ºèšé›†å‹•ç•« */
  body.s1 .gathering-layer {
    opacity: 1;
  }

  /* ä½¿ç”¨ç´” CSS è£½ä½œçš„ä¸è¦å‰‡é›²æœµ */
  .cloud-puff {
    position: absolute;
    background: #ffffff;
    /* ç§»é™¤èƒŒæ™¯åœ–ç‰‡ï¼Œæ”¹ç”¨ç¨‹å¼ç¢¼ç”Ÿæˆçš„é¡è‰²èˆ‡é™°å½± */
    box-shadow: 
        inset -5px -5px 15px rgba(200, 220, 255, 0.4), /* å…§éƒ¨è—è‰²é™°å½±å¢åŠ é«”ç©æ„Ÿ (é…åˆå°å°ºå¯¸å¾®èª¿) */
        2px 5px 10px rgba(0, 0, 0, 0.1); /* å¤–éƒ¨é™°å½± */
    
    opacity: 0; 
    animation: gather-in linear infinite;
  }

  /* èšé›†å‹•ç•«ï¼Œå¾å››å‘¨å¾€ä¸­å¿ƒç§»å‹• */
  @keyframes gather-in {
    0% { 
        transform: translate(var(--start-x), var(--start-y)) scale(0.6) rotate(0deg); 
        opacity: 0; 
    }
    15% {
        opacity: 0.95;
    }
    85% {
        opacity: 0.95;
    }
    100% { 
        transform: translate(0, 0) scale(1.1) rotate(10deg); /* ç¨å¾®æ—‹è½‰å¢åŠ å‹•æ„Ÿ */
        opacity: 0; 
    }
  }

  /* é›¨æ»´å±¤ */
  .rain-container {
    position: absolute;
    top:0; left:0; width:100%; height:100%;
    overflow: hidden;
    pointer-events: none;
    z-index: 15; /* åœ¨è§’è‰²å’ŒèƒŒæ™¯ä¹‹é–“ */
  }
  .drop {
    position: absolute;
    background: white;
    width: 4px; height: 14px;
    border-radius: 4px;
    opacity: 0.6;
    animation: rain-fall linear infinite;
    transition: width 0.5s ease, height 0.5s ease, opacity 0.5s ease;
  }
  @keyframes rain-fall {
    from { transform: translateY(-10vh); }
    to { transform: translateY(110vh); }
  }

  /* æ¨¹è‘‰å±¤ */
  .leaf-container {
      position: absolute;
      top:0; left:0; width:100%; height:100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 16; /* èˆ‡é›¨æ»´åŒå±¤ç´š */
  }
  .leaf {
      position: absolute;
      width: 24px; height: 24px;
      /* ä½¿ç”¨æ·±ç¶ è‰²çš„ SVG æ¨¹è‘‰ */
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233f6212'%3E%3Cpath d='M20.354 5.646a9.985 9.985 0 00-4.95-2.88 10.038 10.038 0 00-9.68 4.167C1.327 12.19 1.404 19.318 1.44 22.56a.5.5 0 00.534.535c3.242.035 10.37-.077 15.627-4.284a10.038 10.038 0 004.167-9.68 9.986 9.986 0 00-2.88-4.95zM5.684 17.61C6.038 15.635 7.24 8.16 13.02 3.797c-4.363 5.78-11.837 6.98-13.814 7.334.367 2.76 2.88 5.27 6.478 6.48z'/%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.9;
      animation: leaf-fall linear infinite;
  }
  @keyframes leaf-fall {
      0% { transform: translate(0, -10vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translate(120vw, 110vh) rotate(720deg); opacity: 0; }
  }

  /* å¼·çƒˆé¢±é¢¨æ™‚çš„éœ‡å‹•æ•ˆæœ */
  .shaking .cloud-body {
    animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both infinite; /* åŠ å¿«éœ‡å‹• */
  }
  @keyframes shake {
    10%, 90% { transform: translate3d(-3px, 0, 0); }
    20%, 80% { transform: translate3d(5px, 0, 0); }
    30%, 50%, 70% { transform: translate3d(-7px, 0, 0); }
    40%, 60% { transform: translate3d(7px, 0, 0); }
  }

  /* é–ƒé›» */
  .flash-overlay {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: white;
    opacity: 0;
    pointer-events: none;
    z-index: 60;
    transition: opacity 0.05s; /* åŠ å¿«é–ƒçˆ */
  }

  /* éŸ¿æ‡‰å¼ */
  @media(max-width: 600px) {
    .sidebar { width: 80px; }
    .thumb { width: 40px; height: 40px; }
    .character-wrap { width: 220px; height: 160px; margin-top: 20px;}
    .info-card { padding: 20px; width: 90%; }
    .info-desc { font-size: 20px; line-height: 2.4; }
    .level-badge { font-size: 18px; }
    .home-btn { font-size: 0.8rem; padding: 0.4rem 0.6rem; }
    .home-btn ruby { display: none; }
  }

  /* --- å„éšæ®µç‰¹æ•ˆè¨­å®š --- */

  /* S1: ç†±å¸¶ä½æ°£å£“ */
  body.s1 { --c-accent: #4dd0e1; background: var(--bg-1); color: var(--c-text); }
  body.s1 .wind-path { animation-duration: 4s; opacity: 0.4; stroke-width: 4; }
  body.s1 .cloud-layer { opacity: 0.5; } 
  body.s1 #typhoon-img { filter: brightness(1); } 

  /* S2: è¼•åº¦é¢±é¢¨ */
  body.s2 { --c-accent: #29b6f6; background: var(--bg-2); color: #334155; }
  body.s2 .wind-path { animation-duration: 2.5s; opacity: 0.6; stroke-width: 6; }
  body.s2 .cloud-layer { opacity: 0.8; } 
  body.s2 #typhoon-img { filter: brightness(0.93); } 

  /* S3: ä¸­åº¦é¢±é¢¨ */
  body.s3 { --c-accent: #5c6bc0; background: var(--bg-3); color: #f8fafc; }
  body.s3 .wind-path { animation-duration: 1.2s; opacity: 0.8; stroke-width: 8; }
  body.s3 .cloud-layer { opacity: 0.95; filter: grayscale(0.4); } 
  body.s3 .header-text { text-shadow: 0 2px 6px rgba(0,0,0,0.4); color: #f1f5f9; } 
  body.s3 #typhoon-img { filter: brightness(0.85) contrast(1.1); } 
  body.s3 .info-desc { color: #1e293b; } /* å¡ç‰‡å…§æ–‡å­—ç¶­æŒæ·±è‰² */

  /* S4: å¼·çƒˆé¢±é¢¨ */
  body.s4 { --c-accent: #78909c; background: var(--bg-4); color: #f1f5f9; }
  body.s4 .wind-path { animation-duration: 0.7s; opacity: 1.0; stroke-width: 10; }
  body.s4 .cloud-layer { opacity: 1.0; filter: grayscale(0.8) brightness(0.7); } 
  body.s4 .header-text { text-shadow: 0 2px 8px rgba(0,0,0,0.8); color: #ffffff; } 
  body.s4 #typhoon-img { filter: brightness(0.7) contrast(1.2); } 
  body.s4 .drop { width: 5px; height: 18px; opacity: 0.8; } 
  body.s4 .info-desc { color: #0f172a; }

</style>
</head>
<body class="s1">
  

<div class="app">
  <!-- èƒŒæ™¯é›²å±¤ -->
  <div class="cloud-layer" id="cloudLayer"></div>
  
  <!-- S1 å°ˆç”¨é›²æœµèšé›†å±¤ -->
  <div class="gathering-layer" id="gatheringLayer"></div>

  <aside class="sidebar" aria-label="æ§åˆ¶é¢æ¿">
    <a href="1203.html" class="home-btn">
        <i class="fa-solid fa-house"></i>
        <ruby>å›<rt>ã„ã„¨ã„ŸËŠ</rt></ruby><ruby>ä¸»<rt>ã„“ã„¨Ë‡</rt></ruby><ruby>é <rt>ã„§ã„Ë‹</rt></ruby>
    </a>

    <button class="btn-circle" id="btnPlus" aria-label="å¢å¼·">ï¼‹</button>
    
    <div class="slider-container" id="sliderContainer">
      <div class="track-bg" id="trackBg">
        <div class="dots">
          <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
        <div class="thumb" id="thumb" tabindex="0" role="slider" aria-orientation="vertical" aria-valuemin="1" aria-valuemax="4" aria-valuenow="1"></div>
      </div>
    </div>

    <button class="btn-circle" id="btnMinus" aria-label="æ¸›å¼±">ï¼</button>
  </aside>

  <main class="main-stage" id="mainStage">
    <div class="flash-overlay" id="flash"></div>

    <header class="header-text">
      <h1 class="title">
        <ruby>é¢±<rt>ã„Šã„ËŠ</rt></ruby><ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby><ruby>å¼·<rt>ã„‘ã„§ã„¤ËŠ</rt></ruby><ruby>åº¦<rt>ã„‰ã„¨Ë‹</rt></ruby><ruby>æ¨¡<rt>ã„‡ã„›ËŠ</rt></ruby><ruby>æ“¬<rt>ã„‹ã„§Ë‡</rt></ruby>
      </h1>
      <div class="subtitle">
        <ruby>å¯<rt>ã„ã„œË‡</rt></ruby><ruby>æ„›<rt>ã„Ë‹</rt></ruby><ruby>ç‰ˆ<rt>ã„…ã„¢Ë‡</rt></ruby> â€¢ <ruby>é»<rt>ã„‰ã„§ã„¢Ë‡</rt></ruby><ruby>æ“Š<rt>ã„ã„§ËŠ</rt></ruby><ruby>ç•«<rt>ã„ã„¨ã„šË‹</rt></ruby><ruby>é¢<rt>ã„‡ã„§ã„¢Ë‹</rt></ruby><ruby>é–‹<rt>ã„ã„</rt></ruby><ruby>å•Ÿ<rt>ã„‘ã„§Ë‡</rt></ruby><ruby>éŸ³<rt>ã„§ã„£</rt></ruby><ruby>æ•ˆ<rt>ã„’ã„§ã„ Ë‹</rt></ruby>
      </div>
    </header>

    <div class="character-wrap" id="cloudChar">
      <svg class="wind-lines" viewBox="0 0 300 200">
        <path class="wind-path" d="M20 100 Q 150 20, 280 100" />
        <path class="wind-path" d="M10 140 Q 150 220, 290 140" style="animation-delay: -1s" />
        <path class="wind-path" d="M40 60 Q 150 -20, 260 60" style="animation-delay: -0.5s" />
      </svg>

      <img id="typhoon-img" class="cloud-body" src="./1766950096919.png" alt="é¢±é¢¨æ€ªç¸">
    </div>

    <div class="info-card">
      <span class="level-badge" id="levelName"><ruby>ç†±<rt>ã„–ã„œË‹</rt></ruby><ruby>å¸¶<rt>ã„‰ã„Ë‹</rt></ruby><ruby>ä½<rt>ã„‰ã„§</rt></ruby><ruby>æ°£<rt>ã„‘ã„§Ë‹</rt></ruby><ruby>å£“<rt>ã„§ã„š</rt></ruby></span>
      <div class="info-desc" id="infoText">
        <ruby>å¤©<rt>ã„Šã„§ã„¢</rt></ruby><ruby>æ°£<rt>ã„‘ã„§Ë‹</rt></ruby><ruby>é‚„<rt>ã„ã„ËŠ</rt></ruby><ruby>ç®—<rt>ã„™ã„¨ã„¢Ë‹</rt></ruby><ruby>ä¸<rt>ã„…ã„¨ËŠ</rt></ruby><ruby>éŒ¯<rt>ã„˜ã„¨ã„›Ë‹</rt></ruby>ï¼Œ<ruby>é›²<rt>ã„©ã„£ËŠ</rt></ruby><ruby>æœµ<rt>ã„‰ã„¨ã„›Ë‡</rt></ruby><ruby>å¿ƒ<rt>ã„’ã„§ã„£</rt></ruby><ruby>æƒ…<rt>ã„‘ã„§ã„¥ËŠ</rt></ruby><ruby>å¾ˆ<rt>ã„ã„£Ë‡</rt></ruby><ruby>å¥½<rt>ã„ã„ Ë‡</rt></ruby>ã€‚<br><ruby>å¶<rt>ã„¡Ë‡</rt></ruby><ruby>çˆ¾<rt>ã„¦Ë‡</rt></ruby><ruby>æœƒ<rt>ã„ã„¨ã„ŸË‹</rt></ruby><ruby>æœ‰<rt>ã„§ã„¡Ë‡</rt></ruby><ruby>ä¸€<rt>ã„§Ë‹</rt></ruby><ruby>é»<rt>ã„‰ã„§ã„¢Ë‡</rt></ruby><ruby>å°<rt>ã„’ã„§ã„ Ë‡</rt></ruby><ruby>é›¨<rt>ã„©Ë‡</rt></ruby>ï¼Œ<ruby>é©<rt>ã„•Ë‹</rt></ruby><ruby>åˆ<rt>ã„ã„œËŠ</rt></ruby><ruby>åœ¨<rt>ã„—ã„Ë‹</rt></ruby><ruby>å®¶<rt>ã„ã„§ã„š</rt></ruby><ruby>ä¼‘<rt>ã„’ã„§ã„¡</rt></ruby><ruby>æ¯<rt>ã„’ã„§ËŠ</rt></ruby>ã€‚
      </div>
    </div>

    <div class="rain-container" id="rainContainer"></div>
    <div class="leaf-container" id="leafContainer"></div>
  </main>
</div>

<script>
// ğŸŸ¢ éŸ³æ•ˆç®¡ç†å™¨ (Sound Manager)
const SoundManager = {
    // ä½¿ç”¨æ‚¨æä¾›çš„ 4 å€‹æª”æ¡ˆ
    stageSounds: [
        'ç†±å¸¶ä½æ°£å£“.mp3', // Level 1
        'è¼•åº¦é¢±é¢¨.mp3',   // Level 2
        'ä¸­åº¦é¢±é¢¨.mp3',   // Level 3
        'å¼·çƒˆé¢±é¢¨.mp3'    // Level 4
    ],
    
    // å„²å­˜ç›®å‰çš„ Audio ç‰©ä»¶
    currentAudio: null,
    isInitialized: false,

    init() {
        if (this.isInitialized) return;
        this.isInitialized = true;
        console.log("Sound system initialized. Click to play.");
    },

    playLevel(level) {
        if (!this.isInitialized) return;

        // åœæ­¢ç›®å‰çš„è²éŸ³
        this.stopAll();

        // æ’­æ”¾å°æ‡‰ç­‰ç´šçš„éŸ³æ•ˆ
        const soundSrc = this.stageSounds[level - 1];
        
        if (soundSrc) {
            this.currentAudio = new Audio(soundSrc);
            this.currentAudio.loop = true; // è¨­å®šç‚ºå¾ªç’°æ’­æ”¾
            this.currentAudio.volume = 1.0; 
            
            // å˜—è©¦æ’­æ”¾ï¼Œè‹¥ç€è¦½å™¨é˜»æ“‹å‰‡æœƒåœ¨ä¸»æ§å°é¡¯ç¤º
            this.currentAudio.play().catch(e => {
                console.log("ç­‰å¾…ä½¿ç”¨è€…äº’å‹•ä»¥æ’­æ”¾è²éŸ³: " + soundSrc);
            });
        }
    },

    stopAll() {
        if (this.currentAudio) {
            this.currentAudio.pause();
            this.currentAudio = null;
        }
    }
};

// æ³¨éŸ³æ’ç‰ˆè‡ªå‹•åŒ–è…³æœ¬
document.addEventListener('DOMContentLoaded', () => {
    window.formatZhuyin = function(container = document) {
        const rtElements = container.querySelectorAll('rt');
        rtElements.forEach(rt => {
            if (rt.querySelector('.zhuyin-symbols')) return;
            const text = rt.innerText.trim();
            if (!text) return;
            const lastChar = text.slice(-1);
            const isTone = ['ËŠ', 'Ë‡', 'Ë‹', 'Ë™'].includes(lastChar);
            if (isTone) {
                const symbols = text.slice(0, -1);
                const tone = lastChar;
                if (tone === 'Ë™') {
                    rt.classList.add('has-light-tone');
                    rt.innerHTML = `<span class="zhuyin-tone-light">${tone}</span><div class="zhuyin-symbols">${Array.from(symbols).map(s => `<span>${s}</span>`).join('')}</div>`;
                } else {
                    rt.innerHTML = `<div class="zhuyin-symbols">${Array.from(symbols).map(s => `<span>${s}</span>`).join('')}</div><span class="zhuyin-tone">${tone}</span>`;
                }
            } else {
                rt.innerHTML = `<div class="zhuyin-symbols">${Array.from(text).map(s => `<span>${s}</span>`).join('')}</div>`;
            }
        });
    };
    formatZhuyin();
});

(() => {
  const typhoonImages = [
    './1766950096919.png',
    './1766950096919(1).png',
    './1766950096919(3).png',
    './1767379157061.png'
  ];

  const stages = [
    { 
        id: 1, 
        name: '<ruby>ç†±<rt>ã„–ã„œË‹</rt></ruby><ruby>å¸¶<rt>ã„‰ã„Ë‹</rt></ruby><ruby>ä½<rt>ã„‰ã„§</rt></ruby><ruby>æ°£<rt>ã„‘ã„§Ë‹</rt></ruby><ruby>å£“<rt>ã„§ã„š</rt></ruby>', 
        text: '<ruby>æµ·<rt>ã„ã„Ë‡</rt></ruby><ruby>é¢<rt>ã„‡ã„§ã„¢Ë‹</rt></ruby><ruby>æœ‰<rt>ã„§ã„¡Ë‡</rt></ruby><ruby>é»<rt>ã„‰ã„§ã„¢Ë‡</rt></ruby><ruby>ç†±<rt>ã„–ã„œË‹</rt></ruby><ruby>ç†±<rt>ã„–ã„œË‹</rt></ruby><ruby>çš„<rt>Ë™ã„‰ã„œ</rt></ruby>ï¼Œ<ruby>é›²<rt>ã„©ã„£ËŠ</rt></ruby><ruby>æœµ<rt>ã„‰ã„¨ã„›Ë‡</rt></ruby><ruby>é–‹<rt>ã„ã„</rt></ruby><ruby>å§‹<rt>ã„•Ë‡</rt></ruby><ruby>èš<rt>ã„ã„©Ë‹</rt></ruby><ruby>é›†<rt>ã„ã„§ËŠ</rt></ruby>ã€‚<br><ruby>å¯<rt>ã„ã„œË‡</rt></ruby><ruby>èƒ½<rt>ã„‹ã„¥ËŠ</rt></ruby><ruby>æœƒ<rt>ã„ã„¨ã„ŸË‹</rt></ruby><ruby>æœ‰<rt>ã„§ã„¡Ë‡</rt></ruby><ruby>äº›<rt>ã„’ã„§ã„</rt></ruby><ruby>é™£<rt>ã„“ã„£Ë‹</rt></ruby><ruby>é›¨<rt>ã„©Ë‡</rt></ruby>ï¼Œ<ruby>å‡º<rt>ã„”ã„¨</rt></ruby><ruby>é–€<rt>ã„‡ã„£ËŠ</rt></ruby><ruby>è¨˜<rt>ã„ã„§Ë‹</rt></ruby><ruby>å¾—<rt>ã„‰ã„œËŠ</rt></ruby><ruby>å¸¶<rt>ã„‰ã„Ë‹</rt></ruby><ruby>å‚˜<rt>ã„™ã„¢Ë‡</rt></ruby><ruby>å–”<rt>ã„›</rt></ruby>ï¼', 
        drops: 30, leaves: 0 
    },
    { 
        id: 2, 
        name: '<ruby>è¼•<rt>ã„‘ã„§ã„¥</rt></ruby><ruby>åº¦<rt>ã„‰ã„¨Ë‹</rt></ruby><ruby>é¢±<rt>ã„Šã„ËŠ</rt></ruby><ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby>', 
        text: '<ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby><ruby>è®Š<rt>ã„…ã„§ã„¢Ë‹</rt></ruby><ruby>å¤§<rt>ã„‰ã„šË‹</rt></ruby><ruby>äº†<rt>Ë™ã„Œã„œ</rt></ruby>ï¼<ruby>æ¨¹<rt>ã„•ã„¨Ë‹</rt></ruby><ruby>è‘‰<rt>ã„§ã„Ë‹</rt></ruby><ruby>è¢«<rt>ã„…ã„ŸË‹</rt></ruby><ruby>å¹<rt>ã„”ã„¨ã„Ÿ</rt></ruby><ruby>å¾—<rt>Ë™ã„‰ã„œ</rt></ruby><ruby>åˆ°<rt>ã„‰ã„ Ë‹</rt></ruby><ruby>è™•<rt>ã„”ã„¨Ë‹</rt></ruby><ruby>é£›<rt>ã„ˆã„Ÿ</rt></ruby>ã€‚<br><ruby>é›²<rt>ã„©ã„£ËŠ</rt></ruby><ruby>æœµ<rt>ã„‰ã„¨ã„›Ë‡</rt></ruby><ruby>è¶Š<rt>ã„©ã„Ë‹</rt></ruby><ruby>ä¾†<rt>ã„Œã„ËŠ</rt></ruby><ruby>è¶Š<rt>ã„©ã„Ë‹</rt></ruby><ruby>å¤š<rt>ã„‰ã„¨ã„›</rt></ruby>ï¼Œ<ruby>é›¨<rt>ã„©Ë‡</rt></ruby><ruby>ä¹Ÿ<rt>ã„§ã„Ë‡</rt></ruby><ruby>è®Š<rt>ã„…ã„§ã„¢Ë‹</rt></ruby><ruby>å¤§<rt>ã„‰ã„šË‹</rt></ruby><ruby>äº†<rt>Ë™ã„Œã„œ</rt></ruby>ã€‚', 
        drops: 80, leaves: 12
    },
    { 
        id: 3, 
        name: '<ruby>ä¸­<rt>ã„“ã„¨ã„¥</rt></ruby><ruby>åº¦<rt>ã„‰ã„¨Ë‹</rt></ruby><ruby>é¢±<rt>ã„Šã„ËŠ</rt></ruby><ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby>', 
        text: '<ruby>å“‡<rt>ã„¨ã„š</rt></ruby>ï¼<ruby>å¥½<rt>ã„ã„ Ë‡</rt></ruby><ruby>å¼·<rt>ã„‘ã„§ã„¤ËŠ</rt></ruby><ruby>çš„<rt>Ë™ã„‰ã„œ</rt></ruby><ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby><ruby>é›¨<rt>ã„©Ë‡</rt></ruby>ï¼<ruby>æ¨¹<rt>ã„•ã„¨Ë‹</rt></ruby><ruby>è‘‰<rt>ã„§ã„Ë‹</rt></ruby><ruby>æ»¿<rt>ã„‡ã„¢Ë‡</rt></ruby><ruby>å¤©<rt>ã„Šã„§ã„¢</rt></ruby><ruby>é£›<rt>ã„ˆã„Ÿ</rt></ruby>ï¼<br><ruby>å¤©<rt>ã„Šã„§ã„¢</rt></ruby><ruby>æ°£<rt>ã„‘ã„§Ë‹</rt></ruby><ruby>è®Š<rt>ã„…ã„§ã„¢Ë‹</rt></ruby><ruby>å¾—<rt>Ë™ã„‰ã„œ</rt></ruby><ruby>é™°<rt>ã„§ã„£</rt></ruby><ruby>æš—<rt>ã„¢Ë‹</rt></ruby>ï¼Œ<ruby>è¶•<rt>ã„ã„¢Ë‡</rt></ruby><ruby>å¿«<rt>ã„ã„¨ã„Ë‹</rt></ruby><ruby>èº²<rt>ã„‰ã„¨ã„›Ë‡</rt></ruby><ruby>é€²<rt>ã„ã„§ã„£Ë‹</rt></ruby><ruby>å®¤<rt>ã„•Ë‹</rt></ruby><ruby>å…§<rt>ã„‹ã„ŸË‹</rt></ruby>ã€‚', 
        drops: 250, leaves: 35
    },
    { 
        id: 4, 
        name: '<ruby>å¼·<rt>ã„‘ã„§ã„¤ËŠ</rt></ruby><ruby>çƒˆ<rt>ã„Œã„§ã„Ë‹</rt></ruby><ruby>é¢±<rt>ã„Šã„ËŠ</rt></ruby><ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby>', 
        text: '<ruby>å±<rt>ã„¨ã„ŸËŠ</rt></ruby><ruby>éšª<rt>ã„’ã„§ã„¢Ë‡</rt></ruby>ï¼<ruby>ç‹‚<rt>ã„ã„¨ã„¤ËŠ</rt></ruby><ruby>é¢¨<rt>ã„ˆã„¥</rt></ruby><ruby>æš´<rt>ã„…ã„ Ë‹</rt></ruby><ruby>é›¨<rt>ã„©Ë‡</rt></ruby><ruby>åŠ <rt>ã„ã„§ã„š</rt></ruby><ruby>ä¸Š<rt>ã„•ã„¤Ë‹</rt></ruby><ruby>é–ƒ<rt>ã„•ã„¢Ë‡</rt></ruby><ruby>é›»<rt>ã„‰ã„§ã„¢Ë‹</rt></ruby>ï¼<br><ruby>å¤–<rt>ã„¨ã„Ë‹</rt></ruby><ruby>é¢<rt>ã„‡ã„§ã„¢Ë‹</rt></ruby><ruby>ä¸€<rt>ã„§ËŠ</rt></ruby><ruby>ç‰‡<rt>ã„†ã„§ã„¢Ë‹</rt></ruby><ruby>é»‘<rt>ã„ã„Ÿ</rt></ruby><ruby>æš—<rt>ã„¢Ë‹</rt></ruby>ï¼Œ<ruby>çµ•<rt>ã„ã„©ã„ËŠ</rt></ruby><ruby>å°<rt>ã„‰ã„¨ã„ŸË‹</rt></ruby><ruby>ä¸<rt>ã„…ã„¨ËŠ</rt></ruby><ruby>èƒ½<rt>ã„‹ã„¥ËŠ</rt></ruby><ruby>å‡º<rt>ã„”ã„¨</rt></ruby><ruby>é–€<rt>ã„‡ã„£ËŠ</rt></ruby>ï¼', 
        drops: 600, leaves: 8 
    }
  ];

  let currentStage = 1;
  const maxStage = 4;
  
  const body = document.body;
  const thumb = document.getElementById('thumb');
  const trackBg = document.getElementById('trackBg');
  const levelName = document.getElementById('levelName');
  const infoText = document.getElementById('infoText');
  const rainContainer = document.getElementById('rainContainer');
  const leafContainer = document.getElementById('leafContainer');
  const cloudChar = document.getElementById('cloudChar');
  const flash = document.getElementById('flash');
  const typhoonImg = document.getElementById('typhoon-img');
  // å–å¾—èšé›†å±¤
  const gatheringLayer = document.getElementById('gatheringLayer');

  function updateUI(stage) {
    stage = Math.max(1, Math.min(4, stage));
    currentStage = stage;

    const pct = ((stage - 1) / 3) * 100; 
    const topPos = 90 - (pct * 0.85); 
    thumb.style.top = `${topPos}%`;

    body.className = `s${stage}`;
    const data = stages[stage - 1];
    
    levelName.innerHTML = `<ruby>ç­‰<rt>ã„‰ã„¥Ë‡</rt></ruby><ruby>ç´š<rt>ã„ã„§ËŠ</rt></ruby> ${data.id}ï¼š${data.name}`;
    infoText.innerHTML = data.text;
    
    if(window.formatZhuyin) window.formatZhuyin(infoText);
    if(window.formatZhuyin) window.formatZhuyin(levelName);

    thumb.setAttribute('aria-valuenow', stage);

    if (typhoonImg) {
        typhoonImg.src = typhoonImages[stage - 1];
    }

    createRain(data.drops, stage);
    createLeaves(data.leaves, stage);

    // S1 é›²æœµèšé›†é‚è¼¯
    if (stage === 1) {
        // å¦‚æœé‚„æ²’æœ‰é›²æœµï¼Œå°±ç”Ÿæˆ
        if (gatheringLayer.childElementCount === 0) {
            createGatheringClouds();
        }
    } else {
        // å…¶ä»–ç­‰ç´šæ¸…ç©ºèšé›†å±¤
        gatheringLayer.innerHTML = '';
    }

    // è¦–è¦ºæ•ˆæœè¨­å®š (é–ƒé›»èˆ‡éœ‡å‹•)
    if (stage === 4) {
      cloudChar.classList.add('shaking');
      startLightning();
    } else {
      cloudChar.classList.remove('shaking');
      stopLightning();
    }

    // æ’­æ”¾å°æ‡‰ç­‰ç´šçš„å°ˆå±¬éŸ³æ•ˆæª”æ¡ˆ
    SoundManager.playLevel(stage);
  }

  // ğŸŸ¢ ç”¢ç”Ÿä¸è¦å‰‡èšé›†é›²æœµçš„å‡½å¼ - ä½¿ç”¨ CSS ç¨‹å¼ç¢¼ç”Ÿæˆ
  function createGatheringClouds() {
      const count = 15; // æ•¸é‡
      for(let i=0; i<count; i++) {
          const cloud = document.createElement('div');
          cloud.classList.add('cloud-puff');
          
          // è¨­å®šåœ¨ç•«é¢ä¸­å¿ƒé™„è¿‘
          cloud.style.left = '50%';
          cloud.style.top = '40%';
          
          // éš¨æ©Ÿå¤§å° - ä¿®æ”¹ç‚ºæ‰é•·å½¢ç‹€ (ç¸®å°å°ºå¯¸)
          const baseSize = 25 + Math.random() * 35; // é¡¯è‘—ç¸®å°ï¼š25px ~ 60px åŸºç¤å€¼
          cloud.style.width = (baseSize * 2.2) + 'px'; // å¯¬åº¦å¢åŠ ï¼Œæ›´æ‰é•·
          cloud.style.height = (baseSize * 0.7) + 'px'; // é«˜åº¦æ¸›å°‘
          
          // ğŸŸ¢ é—œéµï¼šéš¨æ©Ÿç”¢ç”Ÿæœ‰æ©Ÿå½¢ç‹€ (Organic Shape)
          // å¢åŠ  border-radius æ•¸å€¼ä»¥ç¢ºä¿æ›´åœ“æ½¤ã€æœ‰æ›²åº¦
          const r1 = 40 + Math.random() * 40;
          const r2 = 40 + Math.random() * 40;
          const r3 = 40 + Math.random() * 40;
          const r4 = 40 + Math.random() * 40;
          const r5 = 40 + Math.random() * 40;
          const r6 = 40 + Math.random() * 40;
          const r7 = 40 + Math.random() * 40;
          const r8 = 40 + Math.random() * 40;
          
          cloud.style.borderRadius = `${r1}% ${r2}% ${r3}% ${r4}% / ${r5}% ${r6}% ${r7}% ${r8}%`;
          
          // ğŸŸ¢ å·¦å³èšé›†é‚è¼¯ - ä¿®æ”¹ç‚ºå¾ç•«é¢æœ€å·¦å³å…©å´åŒ¯èš
          const side = Math.random() > 0.5 ? 1 : -1;
          
          // ä½¿ç”¨ vw (viewport width) å–®ä½ç¢ºä¿å¾è¢å¹•é‚Šç·£é€²å…¥
          // 50vw æ˜¯å¾ä¸­å¿ƒåˆ°é‚Šç·£çš„è·é›¢ã€‚è¨­å®š 45vw ~ 60vw è®“é›²æœµå¾ç•«é¢é‚Šç·£æˆ–ç¨å¤–å´é–‹å§‹
          const distanceVw = 48 + Math.random() * 15; 
          const startX = (side * distanceVw) + 'vw';
          
          // å‚ç›´ä½ç½®éš¨æ©Ÿåˆ†ä½ˆ (-20vh ~ 20vh)ï¼Œè®“é›²å±¤æœ‰é«˜ä½å·®
          const startY = (Math.random() - 0.5) * 40 + 'vh';
          
          cloud.style.setProperty('--start-x', startX);
          cloud.style.setProperty('--start-y', startY);
          
          // éš¨æ©Ÿå‹•ç•«å»¶é²
          cloud.style.animationDelay = (Math.random() * 2) + 's';
          cloud.style.animationDuration = (2.5 + Math.random() * 1.5) + 's';
          
          gatheringLayer.appendChild(cloud);
      }
  }

  function createRain(count, stage) {
    rainContainer.innerHTML = '';
    const speedBase = stage >= 3 ? 0.5 : 1.0; 
    
    for (let i = 0; i < count; i++) {
      const drop = document.createElement('div');
      drop.classList.add('drop');
      drop.style.left = Math.random() * 100 + '%';
      const scale = 0.8 + Math.random() * 0.4;
      drop.style.transform = `scale(${scale})`;
      
      drop.style.animationDuration = (speedBase + Math.random() * 0.5) + 's';
      drop.style.animationDelay = (Math.random() * -2) + 's';
      drop.style.opacity = Math.random() * 0.5 + 0.3;
      
      const rotate = stage * 7; 
      drop.style.transform += ` rotate(${rotate}deg)`;
      rainContainer.appendChild(drop);
    }
  }

  function createLeaves(count, stage) {
    leafContainer.innerHTML = '';
    if (count === 0) return;

    const speedBase = stage >= 3 ? 2 : 4; 
    
    for (let i = 0; i < count; i++) {
      const leaf = document.createElement('div');
      leaf.classList.add('leaf');
      leaf.style.left = (Math.random() * 120 - 20) + '%';
      leaf.style.top = (Math.random() * -20) + '%';
      
      const scale = 0.6 + Math.random() * 0.6;
      leaf.style.transform = `scale(${scale}) rotate(${Math.random() * 360}deg)`;
      
      leaf.style.animationDuration = (speedBase + Math.random() * 3) + 's';
      leaf.style.animationDelay = (Math.random() * -3) + 's';
      
      leafContainer.appendChild(leaf);
    }
  }

  let lightningTimer = null;
  // é€™è£¡åªè² è²¬è¦–è¦ºä¸Šçš„é–ƒé›»ï¼Œè²éŸ³ç”± audio æª”æ¡ˆæä¾›
  function startLightning() {
    if (lightningTimer) return;
    const loop = () => {
      flash.style.opacity = 0.8;
      setTimeout(() => { flash.style.opacity = 0; }, 80);
      setTimeout(() => { flash.style.opacity = 0.6; }, 120);
      setTimeout(() => { flash.style.opacity = 0; }, 200);
      
      lightningTimer = setTimeout(loop, 1000 + Math.random() * 2000);
    };
    loop();
  }
  function stopLightning() {
    if (lightningTimer) {
      clearTimeout(lightningTimer);
      lightningTimer = null;
    }
    flash.style.opacity = 0;
  }

  // ä½¿ç”¨è€…é¦–æ¬¡äº’å‹•åˆå§‹åŒ–éŸ³æ•ˆ (é¿é–‹ç€è¦½å™¨è‡ªå‹•æ’­æ”¾é™åˆ¶)
  function initAudioOnInteraction() {
      SoundManager.init();
      // ç§»é™¤ç›£è½ï¼Œé¿å…é‡è¤‡åŸ·è¡Œ
      ['click', 'touchstart', 'keydown'].forEach(evt => 
          document.body.removeEventListener(evt, initAudioOnInteraction)
      );
      // å¦‚æœç›®å‰æ˜¯é–‹å•Ÿç‹€æ…‹ï¼Œå˜—è©¦æ’­æ”¾
      SoundManager.playLevel(currentStage);
  }
  
  // ç›£è½å„ç¨®äº’å‹•äº‹ä»¶
  ['click', 'touchstart', 'keydown'].forEach(evt => 
      document.body.addEventListener(evt, initAudioOnInteraction, { once: true })
  );

  document.getElementById('btnPlus').addEventListener('click', () => updateUI(currentStage + 1));
  document.getElementById('btnMinus').addEventListener('click', () => updateUI(currentStage - 1));

  trackBg.addEventListener('pointerdown', (e) => {
    const rect = trackBg.getBoundingClientRect();
    const relativeY = e.clientY - rect.top;
    const ratio = 1 - (relativeY / rect.height); 
    
    let newStage = 1;
    if (ratio > 0.75) newStage = 4;
    else if (ratio > 0.50) newStage = 3;
    else if (ratio > 0.25) newStage = 2;
    
    updateUI(newStage);
  });

  thumb.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    thumb.setPointerCapture(e.pointerId);
    
    const onMove = (ev) => {
      const rect = trackBg.getBoundingClientRect();
      let relativeY = ev.clientY - rect.top;
      if(relativeY < 0) relativeY = 0;
      if(relativeY > rect.height) relativeY = rect.height;
      
      const ratio = 1 - (relativeY / rect.height);
      let newStage = Math.ceil(ratio * 4);
      if(newStage < 1) newStage = 1;
      if(newStage !== currentStage) {
        updateUI(newStage);
      }
    };
    
    const onUp = (ev) => {
      thumb.releasePointerCapture(ev.pointerId);
      document.removeEventListener('pointermove', onMove);
      document.removeEventListener('pointerup', onUp);
    };

    document.addEventListener('pointermove', onMove);
    document.addEventListener('pointerup', onUp);
  });
  
  document.getElementById('mainStage').addEventListener('click', (e) => {
    if(e.target === document.getElementById('mainStage') || e.target.classList.contains('character-wrap')) {
       let next = currentStage + 1;
       if(next > 4) next = 1;
       updateUI(next);
    }
  });

  updateUI(1);

})();
</script>
</body>
</html>
